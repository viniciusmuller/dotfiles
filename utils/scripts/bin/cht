#!/usr/bin/env bash

TMP_DIR=/tmp/cht_sh_cache
TMP_LIST="$TMP_DIR"/cht_sh_list

mkdir -p "$TMP_DIR"

if [ -f "$TMP_LIST" ]; then
  options=`<"$TMP_LIST"`
else
  # Cache cheat sheets list
  options=`curl -s https://cheat.sh/:list`
  echo "$options" > "$TMP_LIST"
fi

selected=`echo "$options" | fzf`

# Exit if selected is empty
[ -z "$selected" ] && exit

data=`curl -s cht.sh/"$selected"`

option_cache_path="$TMP_DIR"/"$selected"

if [ -f "$option_cache_path" ]; then
  options=`<"$option_cache_path"`
else
  # Cache cheat sheet 
  options=`curl -s https://cheat.sh/"$selected"`
  echo "$options" > "$option_cache_path"
fi

echo "$options" | less

